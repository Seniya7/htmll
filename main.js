// Объект с переводами (расширенный)
const translations = {
    en: {
        home: "Home",
        features: "Features",
        about: "About",
        pricing: "Pricing",
        getStarted: "Get Started",
        nextGen: "Next Generation",
        tradingPlatform: "Trading Platform",
        advancedTools: "Advanced tools for professional traders",
        startTrading: "Start Trading",
        watchDemo: "Watch Demo",
        tradingVolume: "Trading Volume",
        activeTraders: "Active Traders",
        countries: "Countries",
        whyChooseUs: "Why Choose TradePro",
        realTimeAnalytics: "Real-time Analytics",
        analyticsDesc: "Advanced market analysis tools with AI-powered insights",
        security: "Bank-Grade Security",
        securityDesc: "Your assets are protected with military-grade encryption",
        speed: "Lightning Fast",
        speedDesc: "Execute trades in milliseconds with our advanced infrastructure",
        automation: "Smart Automation",
        automationDesc: "Automate your trading strategies with ease",
        tradingTools: "Professional Trading Tools",
        advancedCharts: "Advanced Charts",
        chartsDesc: "Professional-grade technical analysis tools",
        topTraders: "Top Traders",
        totalProfit: "Total Profit",
        successRate: "Success Rate",
        follow: "Follow",
        following: "Following",
        howItWorks: "How it Works",
        step1: "Register Account",
        step1desc: "Create your account in just 2 minutes",
        step2: "Fund Account",
        step2desc: "Choose your preferred payment method",
        step3: "Start Trading",
        step3desc: "Access markets and start your journey",
        proTools: "Professional Tools",
        mtrDesc: "Advanced trading analysis and execution",
        smartDesc: "Intelligent trading solutions",
        lockerDesc: "Secure trading environment",
        testimonials: "What Our Traders Say",
        testimonial1: "Best trading platform I've ever used. The tools are incredible!",
        proTrader: "Professional Trader",
        faqTitle: "Frequently Asked Questions",
        faq1: "How do I start trading?",
        faq1answer: "Register an account, complete verification, fund your account, and start trading!",
        quickLinks: "Quick Links",
        footerDesc: "Next generation trading platform",
        advantages: "Our Advantages",
        tools: "Pro Tools",
        toolsDesc: "Professional trading tools",
        totalTraders: "Total Traders",
        totalVolume: "Trading Volume",
        instant: "Instant",
        step1: "1 step",
        step2: "2 step",
        limitedTime: "Limited time",
        evaluationStage: "Evaluation Stage",
        student: "Student",
        practitioner: "Practitioner",
        master: "Master",
        tradingPeriod: "Trading Period",
        minTradingDays: "Minimum Trading Days",
        maxDailyLoss: "Maximum Daily Loss",
        maxLoss: "Maximum Loss",
        profitTarget: "Profit Target",
        leverage: "Leverage",
        rewardsAndSplit: "Rewards & Split",
        tradingInstruments: "Trading Instruments",
        tradingStats: "Trading Statistics",
        monthlyVolume: "Monthly Volume",
        successfulTrades: "Successful Trades",
        liveQuotes: "Live Forex Quotes",
        spread: "Spread",
        economicCalendar: "Economic Calendar",
        time: "Time",
        currency: "Currency",
        event: "Event",
        impact: "Impact",
        forecast: "Forecast",
        high: "High",
        medium: "Medium",
        low: "Low",
        forexNews: "Forex News",
        allNews: "All News",
        marketNews: "Market",
        analysis: "Analysis",
        readMore: "Read More",
        minutesAgo: "minutes ago",
        hoursAgo: "hours ago"
    },
    ru: {
        home: "Главная",
        features: "Функции",
        about: "О нас",
        pricing: "Цены",
        getStarted: "Начать",
        nextGen: "Новое поколение",
        tradingPlatform: "Торговой платформы",
        advancedTools: "Продвинутые инструменты для профессиональных трейдеров",
        startTrading: "Начать торговлю",
        watchDemo: "Смотреть демо",
        tradingVolume: "Объем торгов",
        activeTraders: "Активных трейдеров",
        countries: "Стран",
        whyChooseUs: "Почему TradePro",
        realTimeAnalytics: "Аналитика в реальном времени",
        analyticsDesc: "Продвинутые инструменты анализа рынка с ИИ",
        security: "Банковская безопасность",
        securityDesc: "Ваши активы защищены шифрованием военного уровня",
        speed: "Молниеносная скорость",
        speedDesc: "Исполнение сделок за миллисекунды",
        automation: "Умная автоматизация",
        automationDesc: "Автоматизируйте свои торговые стратегии",
        tradingTools: "Профессиональные инструменты",
        advancedCharts: "Продвинутые графики",
        chartsDesc: "Профессиональные инструменты технического анализа",
        topTraders: "Топ Трейдеров",
        totalProfit: "Общая Прибыль",
        successRate: "Успешность",
        follow: "Подписаться",
        following: "Подписка",
        howItWorks: "Как это работает",
        step1: "Регистрация",
        step1desc: "Создайте аккаунт за 2 минуты",
        step2: "Пополнение",
        step2desc: "Выберите способ оплаты",
        step3: "Начало торговли",
        step3desc: "Получите доступ к рынкам",
        proTools: "Профессиональные инструменты",
        mtrDesc: "Продвинутый анализ и исполнение сделок",
        smartDesc: "Умные торговые решения",
        lockerDesc: "Безопасная торговая среда",
        testimonials: "Отзывы трейдеров",
        testimonial1: "Лучшая торговая платформа, которую я когда-либо использовал!",
        proTrader: "Профессиональный трейдер",
        faqTitle: "Частые вопросы",
        faq1: "Как начать торговать?",
        faq1answer: "Зарегистрируйтесь, пройдите верификацию, пополните счет и начните торговать!",
        quickLinks: "Быстрые ссылки",
        footerDesc: "Торговая платформа нового поколения",
        advantages: "Наши преимущества",
        tools: "Про инструменты",
        toolsDesc: "Профессиональные торговые инструменты",
        totalTraders: "Всего трейдеров",
        totalVolume: "Объем торгов",
        instant: "Мгновенно",
        step1: "1 этап",
        step2: "2 этапа",
        limitedTime: "Ограниченное время",
        evaluationStage: "Этап оценки",
        student: "Студент",
        practitioner: "Практик",
        master: "Мастер",
        tradingPeriod: "Торговый период",
        minTradingDays: "Мин. торговых дней",
        maxDailyLoss: "Макс. дневной убыток",
        maxLoss: "Макс. убыток",
        profitTarget: "Цель по прибыли",
        leverage: "Кредитное плечо",
        rewardsAndSplit: "Награды и разделение",
        tradingInstruments: "Торговые инструменты",
        tradingStats: "Торговая статистика",
        clientReviews: "Отзывы клиентов",
        monthlyVolume: "Месячный объём",
        successfulTrades: "Успешных сделок",
        liveQuotes: "Котировки Форекс",
        spread: "Спред",
        economicCalendar: "Экономический календарь",
        time: "Время",
        currency: "Валюта",
        event: "Событие",
        impact: "Влияние",
        forecast: "Прогноз",
        high: "Высокое",
        medium: "Среднее",
        low: "Низкое",
        forexNews: "Новости Форекс",
        allNews: "Все новости",
        marketNews: "Рынок",
        analysis: "Анализ",
        readMore: "Подробнее",
        minutesAgo: "минут назад",
        hoursAgo: "часов назад"
    },
    ua: {
        home: "Головна",
        features: "Функції",
        about: "Про нас",
        pricing: "Ціни",
        getStarted: "Почати",
        nextGen: "Нове покоління",
        tradingPlatform: "Торгової платформи",
        advancedTools: "Просунуті інструменти для професійних трейдерів",
        startTrading: "Почати торгівлю",
        watchDemo: "Дивитись демо",
        tradingVolume: "Об'єм торгів",
        activeTraders: "Активних трейдерів",
        countries: "Країн",
        whyChooseUs: "Чому TradePro",
        realTimeAnalytics: "Аналітика в реальному часі",
        analyticsDesc: "Просунуті інструменти аналізу ринку зі ШІ",
        security: "Банківська безпека",
        securityDesc: "Ваші активи захищені шифруванням військового рівня",
        speed: "Блискавична швидкість",
        speedDesc: "Виконання угод за мілісекунди",
        automation: "Розумна автоматизація",
        automationDesc: "Автоматизуйте свої торгові стратегії",
        tradingTools: "Професійні інструменти",
        advancedCharts: "Просунуті графіки",
        chartsDesc: "Професійні інструменти технічного аналізу",
        topTraders: "Топ Трейдерів",
        totalProfit: "Загальний Прибуток",
        successRate: "Успішність",
        follow: "Підписатися",
        following: "Підписка",
        howItWorks: "Як це працює",
        step1: "Реєстрація",
        step1desc: "Створіть обліковий запис за 2 хвилини",
        step2: "Поповнення",
        step2desc: "Виберіть спосіб оплати",
        step3: "Початок торгівлі",
        step3desc: "Отримайте доступ до ринків",
        proTools: "Професійні інструменти",
        mtrDesc: "Продвинутий аналіз і виконання угод",
        smartDesc: "Розумні торгові рішення",
        lockerDesc: "Безпечна торгова середа",
        testimonials: "Що кажуть трейдери",
        testimonial1: "Найкраща торгова платформа, яку я коли-небудь використовував!",
        proTrader: "Професійний трейдер",
        faqTitle: "Часті питання",
        faq1: "Як почати торгувати?",
        faq1answer: "Зареєструйтеся, пройдіть верифікацію, поповніть рахунок і почніть торгувати!",
        quickLinks: "Швидкі посилання",
        footerDesc: "Торгова платформа нового покоління",
        forexNews: "Новости Форекс",
        allNews: "Все новости",
        marketNews: "Рынок",
        analysis: "Анализ",
        readMore: "Подробнее",
        minutesAgo: "минут назад",
        hoursAgo: "часов назад"
    }
};

// Код для WebGL фона
const containerEl = document.querySelector(".container");
const canvasEl = document.querySelector("canvas#neuro");
const devicePixelRatio = Math.min(window.devicePixelRatio, 2);

const params = {
    rotation: 1,
    scaleMult: 1.2,
};

const pointer = {
    x: 0,
    y: 0,
    tX: 0,
    tY: 0,
};

let uniforms;
const gl = initShader();

setupEvents();
resizeCanvas();

window.addEventListener("resize", resizeCanvas);
render();

// Функции для WebGL
function initShader() {
    const vsSource = document.getElementById("vertShader").innerHTML;
    const fsSource = document.getElementById("fragShader").innerHTML;

    const gl = canvasEl.getContext("webgl") || canvasEl.getContext("experimental-webgl");

    if (!gl) {
        alert("WebGL is not supported by your browser.");
    }

    function createShader(gl, sourceCode, type) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, sourceCode);
        gl.compileShader(shader);

        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            console.error("An error occurred compiling the shaders: " + gl.getShaderInfoLog(shader));
            gl.deleteShader(shader);
            return null;
        }

        return shader;
    }

    const vertexShader = createShader(gl, vsSource, gl.VERTEX_SHADER);
    const fragmentShader = createShader(gl, fsSource, gl.FRAGMENT_SHADER);

    function createShaderProgram(gl, vertexShader, fragmentShader) {
        const program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            console.error("Unable to initialize the shader program: " + gl.getProgramInfoLog(program));
            return null;
        }

        return program;
    }

    const shaderProgram = createShaderProgram(gl, vertexShader, fragmentShader);
    uniforms = getUniforms(shaderProgram);

    function getUniforms(program) {
        let uniforms = [];
        let uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
        for (let i = 0; i < uniformCount; i++) {
            let uniformName = gl.getActiveUniform(program, i).name;
            uniforms[uniformName] = gl.getUniformLocation(program, uniformName);
        }
        return uniforms;
    }

    const vertices = new Float32Array([-1., -1., 1., -1., -1., 1., 1., 1.]);

    const vertexBuffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

    gl.useProgram(shaderProgram);

    const positionLocation = gl.getAttribLocation(shaderProgram, "a_position");
    gl.enableVertexAttribArray(positionLocation);

    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
    gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

    return gl;
}

function render() {
    const currentTime = performance.now();

    pointer.x += (pointer.tX - pointer.x) * .5;
    pointer.y += (pointer.tY - pointer.y) * .5;

    gl.uniform1f(uniforms.u_time, currentTime);
    gl.uniform2f(uniforms.u_pointer_position, pointer.x / window.innerWidth, 1 - pointer.y / window.innerHeight);
    gl.uniform1f(uniforms.u_scroll_progress, window["pageYOffset"] / (2 * window.innerHeight));

    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
    requestAnimationFrame(render);
}

function resizeCanvas() {
    canvasEl.width = window.innerWidth * devicePixelRatio;
    canvasEl.height = window.innerHeight * devicePixelRatio;
    gl.uniform1f(uniforms.u_ratio, canvasEl.width / canvasEl.height);
    gl.viewport(0, 0, canvasEl.width, canvasEl.height);
}

// Обновленная функция setupEvents для обработки как событий фона, так и языкового селектора
function setupEvents() {
    // События для WebGL
    window.addEventListener("pointermove", e => {
        updateMousePosition(e.clientX, e.clientY);
    });
    window.addEventListener("touchmove", e => {
        updateMousePosition(e.targetTouches[0].clientX, e.targetTouches[0].clientY);
    });
    window.addEventListener("click", e => {
        updateMousePosition(e.clientX, e.clientY);
    });

    function updateMousePosition(eX, eY) {
        pointer.tX = eX;
        pointer.tY = eY;
    }

    // События для языкового селектора
    const dropdownLinks = document.querySelectorAll('.dropdown-content a');
    const selectedLang = document.querySelector('.selected-lang');

    dropdownLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const lang = link.getAttribute('data-lang');
            selectedLang.textContent = lang.toUpperCase();
            changeLanguage(lang);
        });
    });

    // Загрузка сохраненного языка
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    selectedLang.textContent = savedLanguage.toUpperCase();
    changeLanguage(savedLanguage);

    // Плавная прокрутка для навигации
    document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Анимация появления элементов при скролле
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    document.querySelectorAll('.feature-card, .stat-item').forEach(el => {
        observer.observe(el);
    });

    // Обработчики для кнопок подписки
    document.querySelectorAll('.follow-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const isFollowing = this.classList.contains('following');
            if (isFollowing) {
                this.classList.remove('following');
                this.textContent = translations[currentLang].follow;
                this.style.background = 'rgba(0, 255, 102, 0.1)';
            } else {
                this.classList.add('following');
                this.textContent = translations[currentLang].following;
                this.style.background = '#00ff66';
                this.style.color = '#151912';
            }
        });
    });
}

// Функция смены языка
function changeLanguage(lang) {
    localStorage.setItem('selectedLanguage', lang);
    
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });

    const selectedLang = document.querySelector('.selected-lang');
    if (selectedLang) {
        selectedLang.textContent = lang.toUpperCase();
    }
}

// Функция инициализации всех компонентов
function initializeComponents() {
    initializeMobileMenu();
    initializeAnimations();
    initializeCounters();
    initializeTradeNotifications();
    initializeFAQ();
    initializePricing();
    initializeInstruments();
    initializeStatistics();
    initializeForexQuotes();
    initializeEconomicCalendar();
    initializeForexNews();
}

// Мобильное меню
function initializeMobileMenu() {
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const nav = document.querySelector('nav');
    const navLinks = document.querySelectorAll('nav a');

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', () => {
            nav.classList.toggle('active');
            mobileMenuBtn.innerHTML = nav.classList.contains('active') ? '✕' : '☰';
            document.body.style.overflow = nav.classList.contains('active') ? 'hidden' : '';
        });

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                nav.classList.remove('active');
                mobileMenuBtn.innerHTML = '☰';
                document.body.style.overflow = '';
            });
        });

        document.addEventListener('click', (e) => {
            if (!nav.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                nav.classList.remove('active');
                mobileMenuBtn.innerHTML = '☰';
                document.body.style.overflow = '';
            }
        });
    }
}

// Анимации при скролле
function initializeAnimations() {
    // Анимация появления секций при скролле
    const sections = document.querySelectorAll('section');
    const observerOptions = {
        threshold: 0.2,
        rootMargin: '0px 0px -50px 0px'
    };

    const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                sectionObserver.unobserve(entry.target);
            }
        });
    }, observerOptions);

    sections.forEach(section => {
        sectionObserver.observe(section);
    });

    // Плавное появление элементов при загрузке
    document.querySelectorAll('.hero, .feature-icon, .step-icon').forEach(el => {
        el.classList.add('floating');
    });
}

// Анимированные счетчики
function initializeCounters() {
    const stats = document.querySelectorAll('.stat-number');
    
    const observerOptions = {
        threshold: 0.5
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const target = entry.target;
                const endValue = parseInt(target.getAttribute('data-value'));
                const duration = 2000;
                const increment = endValue / (duration / 16);
                let currentValue = 0;

                function updateCounter() {
                    currentValue += increment;
                    if (currentValue < endValue) {
                        target.textContent = Math.floor(currentValue).toLocaleString();
                        requestAnimationFrame(updateCounter);
                    } else {
                        target.textContent = endValue.toLocaleString();
                    }
                }

                updateCounter();
                observer.unobserve(target);
            }
        });
    }, observerOptions);

    stats.forEach(stat => observer.observe(stat));
}

// Уведомления о торговых успехах
function initializeTradeNotifications() {
    const notifications = [
        { name: "Alex M.", profit: "$1,234", time: "2 minutes ago" },
        { name: "Sarah K.", profit: "$5,678", time: "5 minutes ago" },
        { name: "John D.", profit: "$2,345", time: "7 minutes ago" }
    ];

    let currentIndex = 0;

    function showNotification() {
        const notification = notifications[currentIndex];
        
        const notifElement = document.createElement('div');
        notifElement.className = 'trade-notification';
        notifElement.innerHTML = `
            <div class="notification-content">
                <div class="notification-icon">💰</div>
                <div class="notification-text">
                    <p>${notification.name} made ${notification.profit}</p>
                    <span>${notification.time}</span>
                </div>
            </div>
        `;

        document.body.appendChild(notifElement);

        setTimeout(() => {
            notifElement.classList.add('show');
        }, 100);

        setTimeout(() => {
            notifElement.classList.remove('show');
            setTimeout(() => {
                notifElement.remove();
            }, 300);
        }, 5000);

        currentIndex = (currentIndex + 1) % notifications.length;
    }

    setInterval(showNotification, 15000);
}

// FAQ аккордеон
function initializeFAQ() {
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        question.addEventListener('click', () => {
            const isActive = item.classList.contains('active');
            faqItems.forEach(faq => faq.classList.remove('active'));
            if (!isActive) {
                item.classList.add('active');
            }
        });
    });
}

// Функция для обработки кнопок
function setupButtons() {
    const startButtons = document.querySelectorAll('.primary-btn, .get-started');
    startButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Здесь можно добавить логику для регистрации/начала торговли
            console.log('Start Trading clicked');
        });
    });

    const demoButton = document.querySelector('.secondary-btn');
    if (demoButton) {
        demoButton.addEventListener('click', () => {
            // Здесь можно добавить логику для демо-режима
            console.log('Watch Demo clicked');
        });
    }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
    setupEvents();
    resizeCanvas();
    render();
    
    // Новые инициализации
    initializeComponents();
    setupButtons();

    // Добавляем Chart.js
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    script.onload = () => {
        const timeScript = document.createElement('script');
        timeScript.src = 'https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns';
        timeScript.onload = () => {
            initChart();
        };
        document.head.appendChild(timeScript);
    };
    document.head.appendChild(script);
});

function initChart() {
    const ctx = document.getElementById('tradingChart').getContext('2d');
    
    // Генерируем случайные данные для графика
    const data = [];
    let price = 43500;
    for (let i = 0; i < 100; i++) {
        price += (Math.random() - 0.5) * 100;
        data.push({
            x: new Date(Date.now() - (100 - i) * 360000),
            y: price
        });
    }

    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'BTC/USDT',
                data: data,
                borderColor: '#00ff66',
                backgroundColor: 'rgba(0, 255, 102, 0.1)',
                borderWidth: 2,
                pointRadius: 0,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    titleColor: '#00ff66',
                    bodyColor: '#fff',
                    padding: 12,
                    displayColors: false
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'hour'
                    },
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.6)'
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.6)'
                    }
                }
            }
        }
    });

    // Обработчики для кнопок временных интервалов
    document.querySelectorAll('.time-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelector('.time-btn.active').classList.remove('active');
            btn.classList.add('active');
            // Здесь можно добавить логику обновления данных графика
        });
    });
}

// Добавьте новую функцию для инициализации тарифов:
function initializePricing() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const sizeButtons = document.querySelectorAll('.size-btn');
    const pricingCards = document.querySelectorAll('.pricing-card');

    // Данные о тарифах для разных размеров счета
    const accountSizes = {
        '5K': {
            student: { profitTarget: '$400 (8%)', maxLoss: '10%', maxDailyLoss: '5%' },
            practitioner: { profitTarget: '$250 (5%)', maxLoss: '10%', maxDailyLoss: '5%' }
        },
        '10K': {
            student: { profitTarget: '$800 (8%)', maxLoss: '10%', maxDailyLoss: '5%' },
            practitioner: { profitTarget: '$500 (5%)', maxLoss: '10%', maxDailyLoss: '5%' }
        },
        '25K': {
            student: { profitTarget: '$2.000 (8%)', maxLoss: '10%', maxDailyLoss: '5%' },
            practitioner: { profitTarget: '$1.250 (5%)', maxLoss: '10%', maxDailyLoss: '5%' }
        },
        '50K': {
            student: { profitTarget: '$4.000 (8%)', maxLoss: '10%', maxDailyLoss: '5%' },
            practitioner: { profitTarget: '$2.500 (5%)', maxLoss: '10%', maxDailyLoss: '5%' }
        },
        '100K': {
            student: { profitTarget: '$8.000 (8%)', maxLoss: '10%', maxDailyLoss: '5%' },
            practitioner: { profitTarget: '$5.000 (5%)', maxLoss: '10%', maxDailyLoss: '5%' }
        }
    };

    // Обработка переключения табов
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('selected', 'active'));
            button.classList.add('selected');
            
            // Анимация карточек при переключении
            pricingCards.forEach(card => {
                card.style.opacity = '0';
                setTimeout(() => {
                    card.style.opacity = '1';
                }, 300);
            });
        });
    });

    // Обработка выбора размера счета
    sizeButtons.forEach(button => {
        button.addEventListener('click', () => {
            sizeButtons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');

            const size = button.textContent;
            updatePricingValues(size);
        });
    });

    // Функция обновления значений в карточках
    function updatePricingValues(size) {
        const sizeData = accountSizes[size];
        if (!sizeData) return;

        // Обновляем значения для Student
        const studentCard = document.querySelector('.pricing-card:nth-child(1)');
        if (studentCard && sizeData.student) {
            updateCardValues(studentCard, sizeData.student);
        }

        // Обновляем значения для Practitioner
        const practitionerCard = document.querySelector('.pricing-card:nth-child(2)');
        if (practitionerCard && sizeData.practitioner) {
            updateCardValues(practitionerCard, sizeData.practitioner);
        }
    }

    // Вспомогательная функция для обновления значений в карточке
    function updateCardValues(card, data) {
        const features = card.querySelectorAll('.feature');
        features.forEach(feature => {
            const label = feature.querySelector('span:first-child').textContent;
            const valueSpan = feature.querySelector('.value');
            
            if (label.includes('Profit Target') && data.profitTarget) {
                valueSpan.textContent = data.profitTarget;
            } else if (label.includes('Maximum Loss') && data.maxLoss) {
                valueSpan.textContent = data.maxLoss;
            } else if (label.includes('Maximum Daily Loss') && data.maxDailyLoss) {
                valueSpan.textContent = data.maxDailyLoss;
            }
        });
    }

    // Анимация появления карточек при загрузке
    pricingCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200);
    });
}

// Улучшенная обработка наведения для кнопок
function initializeButtonEffects() {
    const buttons = document.querySelectorAll('.primary-btn, .secondary-btn, .get-started');
    
    buttons.forEach(button => {
        button.addEventListener('mousemove', (e) => {
            const rect = button.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            button.style.setProperty('--x', `${x}px`);
            button.style.setProperty('--y', `${y}px`);
        });
    });
}

// Функция для инициализации торговых инструментов
function initializeInstruments() {
    const pairs = document.querySelectorAll('.pair');
    
    pairs.forEach(pair => {
        pair.addEventListener('mouseenter', () => {
            pair.style.background = 'rgba(255, 255, 255, 0.08)';
        });
        
        pair.addEventListener('mouseleave', () => {
            pair.style.background = 'rgba(255, 255, 255, 0.03)';
        });
    });

    // Живые спреды (имитация)
    setInterval(() => {
        pairs.forEach(pair => {
            const spreadElement = pair.querySelector('.spread');
            const currentSpread = parseFloat(spreadElement.textContent);
            const variation = (Math.random() - 0.5) * 0.1;
            const newSpread = Math.max(0.1, (currentSpread + variation).toFixed(1));
            spreadElement.textContent = newSpread;
            
            // Анимация изменения
            spreadElement.style.color = variation > 0 ? '#ff4444' : '#00ff66';
            setTimeout(() => {
                spreadElement.style.color = '#00ff66';
            }, 500);
        });
    }, 3000);
}

// Функция для анимации статистики
function initializeStatistics() {
    const stats = document.querySelectorAll('.stat-number');
    
    const observerOptions = {
        threshold: 0.5,
        rootMargin: '0px'
    };

    const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateValue(entry.target);
                statsObserver.unobserve(entry.target);
            }
        });
    }, observerOptions);

    stats.forEach(stat => statsObserver.observe(stat));

    function animateValue(element) {
        const endValue = parseInt(element.getAttribute('data-value'));
        const duration = 2000;
        const startTime = performance.now();
        
        function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Эффект замедления в конце
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const currentValue = Math.floor(endValue * easeOutQuart);
            
            element.textContent = currentValue.toLocaleString();
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        }
        
        requestAnimationFrame(update);
    }
}

// Функция для живых обновлений данных
function initializeLiveUpdates() {
    setInterval(() => {
        // Имитация живых обновлений статистики
        const stats = document.querySelectorAll('.stat-number');
        stats.forEach(stat => {
            const currentValue = parseInt(stat.textContent.replace(/,/g, ''));
            const variation = Math.floor(Math.random() * 10) - 5;
            const newValue = currentValue + variation;
            stat.textContent = newValue.toLocaleString();
            
            // Анимация изменения
            stat.style.transform = 'scale(1.1)';
            setTimeout(() => {
                stat.style.transform = 'scale(1)';
            }, 200);
        });
    }, 10000);
}

// Функция для инициализации форекс котировок
function initializeForexQuotes() {
    const pairs = {
        'EUR/USD': { base: 1.2345, volatility: 0.0002 },
        'GBP/USD': { base: 1.3456, volatility: 0.0003 },
        'USD/JPY': { base: 110.45, volatility: 0.02 }
    };

    function updateQuotes() {
        Object.entries(pairs).forEach(([pair, data]) => {
            const card = document.querySelector(`.quote-card:has(.pair-name:contains("${pair}"))`);
            if (!card) return;

            const priceElement = card.querySelector('.price');
            const changeElement = card.querySelector('.change');
            const spreadElement = card.querySelector('.spread-value');

            // Генерируем новую цену
            const change = (Math.random() - 0.5) * data.volatility;
            const newPrice = (data.base + change).toFixed(4);
            const changePercent = (change / data.base * 100).toFixed(2);

            // Определяем направление изменения
            const isPositive = change >= 0;
            const changeClass = isPositive ? 'positive' : 'negative';
            const changeSign = isPositive ? '+' : '';

            // Обновляем элементы
            priceElement.textContent = newPrice;
            changeElement.textContent = `${changeSign}${changePercent}%`;
            changeElement.className = `change ${changeClass}`;

            // Анимация обновления
            priceElement.classList.add('price-update');
            setTimeout(() => priceElement.classList.remove('price-update'), 300);

            // Случайное изменение спреда
            const newSpread = (Math.random() * 0.3 + 0.1).toFixed(1);
            spreadElement.textContent = newSpread;
        });
    }

    // Обновляем котировки каждую секунду
    setInterval(updateQuotes, 1000);
}

// Функция для инициализации экономического календаря
function initializeEconomicCalendar() {
    const calendarEvents = [
        {
            time: "08:30",
            currency: "EUR",
            event: "ECB Interest Rate Decision",
            impact: "high",
            forecast: "0.25%"
        },
        {
            time: "12:30",
            currency: "USD",
            event: "Non-Farm Payrolls",
            impact: "high",
            forecast: "200K"
        },
        {
            time: "15:00",
            currency: "GBP",
            event: "BOE Governor Speech",
            impact: "medium",
            forecast: "-"
        }
    ];

    const calendarContainer = document.querySelector('.calendar-events');
    if (!calendarContainer) return;

    function updateCalendar() {
        calendarContainer.innerHTML = '';

        calendarEvents.forEach(event => {
            const eventElement = document.createElement('div');
            eventElement.className = 'calendar-event';
            eventElement.innerHTML = `
                <span>${event.time}</span>
                <span>${event.currency}</span>
                <span class="event-name">${event.event}</span>
                <span class="impact-${event.impact}">${translations[currentLang][event.impact]}</span>
                <span>${event.forecast}</span>
            `;
            calendarContainer.appendChild(eventElement);
        });
    }

    // Обновляем календарь каждый час
    updateCalendar();
    setInterval(updateCalendar, 3600000);

    // Добавляем тултипы для событий
    const eventNames = document.querySelectorAll('.event-name');
    eventNames.forEach(name => {
        name.classList.add('tooltip');
        name.setAttribute('data-tooltip', 'Click for details');
    });
}

// Вспомогательная функция для форматирования чисел
function formatNumber(number, decimals = 2) {
    return number.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Функция для анимации изменения значений
function animateValue(element, start, end, duration = 500) {
    const range = end - start;
    const startTime = performance.now();

    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        const value = start + (range * progress);
        element.textContent = formatNumber(value);

        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }

    requestAnimationFrame(update);
}

// Пример использования бесплатного API форекс новостей
async function getForexNews() {
    try {
        // Здесь нужно будет использовать ваш API ключ
        const response = await fetch('https://api.example.com/forex-news');
        const news = await response.json();
        updateNewsSection(news);
    } catch (error) {
        console.error('Error fetching news:', error);
    }
}

// Функция для инициализации новостей
function initializeForexNews() {
    const newsGrid = document.querySelector('.news-grid');
    const filterButtons = document.querySelectorAll('.filter-btn');
    let currentFilter = 'all';
    
    // Функция для форматирования времени
    function formatTimeAgo(date) {
        const now = new Date();
        const diff = Math.floor((now - date) / 1000 / 60); // разница в минутах
        
        if (diff < 60) {
            return `${diff} ${translations[currentLang].minutesAgo}`;
        }
        return `${Math.floor(diff / 60)} ${translations[currentLang].hoursAgo}`;
    }

    // Функция для загрузки новостей
    async function loadNews(filter = 'all') {
        try {
            // Показываем лоадер
            document.querySelector('.news-loader').style.display = 'flex';
            
            // Здесь должен быть ваш API ключ и URL
            const API_KEY = 'YOUR_API_KEY';
            const response = await fetch(`https://api.example.com/forex-news?category=${filter}&apikey=${API_KEY}`);
            const data = await response.json();
            
            // Очищаем текущие новости
            newsGrid.innerHTML = '';
            
            // Добавляем новые новости
            data.articles.forEach(article => {
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card';
                newsCard.innerHTML = `
                    <img src="${article.image}" alt="${article.title}" class="news-image">
                    <div class="news-content">
                        <span class="news-category">${article.category}</span>
                        <h3 class="news-title">${article.title}</h3>
                        <div class="news-meta">
                            <span>${formatTimeAgo(new Date(article.publishedAt))}</span>
                            <a href="${article.url}" target="_blank" rel="noopener noreferrer">
                                ${translations[currentLang].readMore}
                            </a>
                        </div>
                    </div>
                `;
                newsGrid.appendChild(newsCard);
            });
        } catch (error) {
            console.error('Error loading news:', error);
            newsGrid.innerHTML = `<p>Error loading news. Please try again later.</p>`;
        } finally {
            // Скрываем лоадер
            document.querySelector('.news-loader').style.display = 'none';
        }
    }

    // Обработчики фильтров
    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentFilter = button.dataset.filter;
            loadNews(currentFilter);
        });
    });

    // Загружаем новости при инициализации
    loadNews();

    // Обновляем новости каждые 5 минут
    setInterval(() => loadNews(currentFilter), 300000);
}
